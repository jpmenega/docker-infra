============================
Source script server pre req
apt install ansible
ssh-keygen
ssh-copy-id root@<node_ip>
============================
Source script server
mkdir ~/docker-cluster
cd ~/docker-cluster

nano hosts-samba (alterar IPs)

ansible-playbook -i hosts-samba main/initial.yml
ansible-playbook -i hosts-samba lb/loadbalancer.yml

#ansible-playbook -i hosts-samba gluster/glusterfs.yml
ansible-playbook -i hosts-samba samba-ad-dc/samba.yml

!! Executar setup do Samba pelo Pacemaker antes de configurar o backup

ansible-playbook -i hosts-samba samba-ad-dc/backup-client.yml
# comando para instalar o cliente, mas nao usar esse, usar URL local que ja tem a chave do cliente...
TF=$(mktemp) && wget "https://hndl.urbackup.org/Client/2.4.11/UrBackup%20Client%20Linux%202.4.11.sh" -O $TF && sudo sh $TF; rm -f $TF
# criar client no UrBackup server (Internet client/client behind NAT) e pegar a linha de codigo para executar nos clientes ja com a chave
ansible-playbook -i hosts-samba samba-ad-dc/backup-client-part2.yml

# smb.conf example
cd /var/lib/samba
rm smb.conf
wget https://raw.githubusercontent.com/jpmenega/docker-infra/main/samba-ad-dc/example/smb.conf

# share permissions
https://superuser.com/questions/1459741/samba-ad-dc-windows-explorer-exe-crashes-on-security-tab-access
samba-tool ntacl get --as-sddl /var/lib/samba/sysvol/SAMDOM/scripts
samba-tool ntacl set "O:LAG:BAD:P(A;OICI;0x001f01ff;;;BA)(A;OICI;0x001200a9;;;SO)(A;OICI;0x001f01ff;;;SY)(A;OICI;0x001200a9;;;AU)" /var/lib/samba/volumes/

# reload samba config
killall -HUP smbd nmbd
smbcontrol smbd reload-config
smbstatus #acaba validando o smb.conf

# antes setar a senha do SMTP no hosts-samba (ltb_mail_smtp_pass=)
ansible-playbook -i hosts-samba ~/docker-cluster/samba-ad-dc/self-service-password.yml
